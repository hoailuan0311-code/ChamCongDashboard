<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<title>üìÖ Dashboard Ph·∫£n H·ªìi Ch·∫•m C√¥ng ‚Äì WAREHOUSE RYOBI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Font ti·∫øng Vi·ªát -->
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;600;800&display=swap" rel="stylesheet">

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

<style>
:root {
    --bg: #f5f7fa;
    --text: #111;
    --box: #fff;
    --box-border: #ddd;
}
@media (prefers-color-scheme: dark) {
    :root {
        --bg: #121212;
        --text: #eee;
        --box: #1e1e1e;
        --box-border: #333;
    }
}

body {
    background: var(--bg);
    color: var(--text);
    font-family: "Be Vietnam Pro", sans-serif;
    margin: 20px;
}

h1 {
    text-align: center;
    font-size: 42px;
    font-weight: 800;
    margin-bottom: 10px;
    background: linear-gradient(90deg, #4facfe, #00f2fe);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 12px rgba(0,255,255,0.25);
}

.search-bar input {
    padding: 8px;
    width: 260px; /* THU NH·ªé */
    margin-right: 10px;
    border-radius: 6px;
    border: 1px solid var(--box-border);
    background: var(--box);
    color: var(--text);
}

.search-bar button {
    padding: 10px 16px;
    border-radius: 10px;
    cursor: pointer;
    border: none;
    font-weight: 600;
    color: white;
    transition: 0.25s;
}

/* N√∫t ch√≠nh */
.feedback-btn {
    background: linear-gradient(135deg, #06b6d4, #3b82f6);
    box-shadow: 0 10px 20px rgba(59,130,246,0.35);
    margin-left: 6px;
}

.feedback-btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 14px 28px rgba(59,130,246,0.45);
}

/* Late Out Missing button */
#lomBtn {
    background: linear-gradient(135deg, #e63946, #d90429);
    box-shadow: 0 10px 20px rgba(230,57,70,0.35);
}

#lomBtn:hover {
    transform: translateY(-1px);
    box-shadow: 0 14px 30px rgba(230,57,70,0.45);
}

/* Xem Ch·ªët C√¥ng */
#viewClosingBtn {
    background: linear-gradient(135deg, #f59e0b, #f97316);
    box-shadow: 0 10px 20px rgba(249,115,22,0.35);
}

#viewClosingBtn:hover {
    transform: translateY(-1px);
    box-shadow: 0 14px 30px rgba(249,115,22,0.45);
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    background: var(--box);
    border-radius: 12px;
    overflow: hidden;
}
th, td { padding: 10px; border-bottom: 1px solid var(--box-border); }
th { background: rgba(0,0,0,0.05); cursor: pointer; }

.badge { padding: 4px 12px; border-radius: 16px; font-size: 12px; color: white; }
.confirm-none { background: #ff6b6b; }
.confirm-done { background: #2ecc71; }

.chart-box {
    background: var(--box);
    padding: 15px;
    border-radius: 12px;
    border: 1px solid var(--box-border);
    margin-top: 20px;
}

audio { display: none; }
</style>
</head>
<body>

<h1>Dashboard Ph·∫£n H·ªìi Ch·∫•m C√¥ng ‚Äì WAREHOUSE RYOBI</h1>
<p>üïì D·ªØ li·ªáu ƒë∆∞·ª£c c·∫≠p nh·∫≠t t·ª± ƒë·ªông ‚ù§Ô∏èü´∂‚ù§Ô∏è</p>

<!-- SEARCH BAR (ƒê√É G·ªòP + THU NH·ªé + X√ìA CLEAR BUTTON) -->
<div class="search-bar">
    <input id="searchAll" placeholder="T√¨m theo MSNV ho·∫∑c H·ªç T√™n‚Ä¶">

    <button id="feedbackBtn" class="feedback-btn">üìù Ph·∫£n h·ªìi ch·∫•m c√¥ng</button>

    <button id="passBtn" class="feedback-btn" style="background:linear-gradient(135deg,#16a085,#27ae60)">
        üîê Qu√™n Pass CADENA
    </button>

    <button id="viewPassBtn" class="feedback-btn" style="background:linear-gradient(135deg,#8e44ad,#9b59b6)">
        üìÅ Xem Pass CADENA
    </button>

    <button id="viewClosingBtn">üìä Xem Ch·ªët C√¥ng</button>

    <button id="lomBtn">üî¥ Late ‚Ä¢ Out ‚Ä¢ Missing</button>
</div>
<script>
const jsonUrl = "https://hoailuan0311-code.github.io/ChamCongDashboard/data.json";
let fullData = [];

async function loadData(){
    let res = await fetch(jsonUrl + "?cache=" + Date.now());
    fullData = await res.json();
    renderAll(fullData);
}
loadData();

/* FORMAT DATE */
function excelDate(v){
    if (!v) return "";
    const d = new Date((v - 25569) * 86400 * 1000);
    return isNaN(d) ? v : d.toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric"});
}

/* SEARCH G·ªòP */
document.getElementById("searchAll").addEventListener("input", ()=>{
    let key = searchAll.value.toLowerCase();
    let f = fullData.filter(r =>
        (r.MSNV+"").includes(key) ||
        (r.FullName+"").toLowerCase().includes(key)
    );
    renderAll(f);
});

/* SORT */
function sortBy(col){
    fullData.sort((a,b)=>(a[col] > b[col] ? 1 : -1));
    renderAll(fullData);
}

/* RENDER TABLE */
function renderTable(data){
    let tbody = document.querySelector("#dataTable tbody");
    tbody.innerHTML = "";

    data.forEach(r=>{
        tbody.innerHTML += `
        <tr>
            <td>${r.MSNV}</td>
            <td>${r.FullName}</td>
            <td>${excelDate(r.NgayDieuChinh)}</td>
            <td>${r.NoiDung || ""}</td>
            <td><span class="badge ${r.ConfirmAdmin ? "confirm-done":"confirm-none"}">${r.ConfirmAdmin || "Ch∆∞a ph·∫£n h·ªìi"}</span></td>
            <td>${r.BU || ""}</td>
            <td>${r.Team || ""}</td>
        </tr>`;
    });
}

/* RENDER WRAPPER */
function renderAll(data){
    renderTable(data);
    renderBU(data);
    renderTeam(data);
    renderTop(data);
    renderNgay(data);
}

/* N√öT M·ªöI */
document.getElementById("viewClosingBtn").addEventListener("click", ()=>{
    window.open("#", "_blank"); // Cris ƒë·∫∑t link sau
});
document.getElementById("lomBtn").addEventListener("click", ()=>{
    window.open("#", "_blank"); // Cris ƒë·∫∑t link sau
});
